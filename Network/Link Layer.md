# Link Layer
## Definition, Introduction
- - -
- Node: 링크 계층 프로토콜을 실행하는 장치
- Link: 통신 경로상의 인접한 노드들을 연결하는 통신 채널
한 링크에서 전송 노드는 데이터그램을 링크 계층 프레임으로 캡슐화해서 링크로 전송한다.
## Linker Layer Service
- - - 
- 프레임화
  네트워크 계층 데이터그램을 링크상으로 전송하기 전에 링크 계층 프레임에 삽입한다.
- 링크 접속
  `MAC(Medium Access Control)`프로토콜은 링크상으로 프레임을 전송하는 규칙에 대해서 명시한다. 점대점 프로토콜의 경우 MAC 프로토콜은
  단순하며, 브로드캐스트 링크를 여러 노드가 공유하는 경우 MAC은 여러 노드로부터의 프레임 전송을 조정한다.
- 신뢰적 전달
  TCP 같은 일부 트랜스포트 계층 프로토콜에서는 신뢰적 전달 서비스를 제공한다. 링크도 마찬가지로 ACK를 통해 이것이 가능하다.
  Transport와 Application과 달리, Link는 오류가 발생한 링크에서 오류를 정정한다. 대다수는 무선 환경에서 이 기능을 제공한다.
- 오류 검출과 정정
  링크 계층에서의 오류 검출은 단순히 `Checksum`으로 계산하지 않는다. 프레임 안의 오류 검출뿐만 아니라 프레임의 어느곳에서 오류가
  발생했는지 파악한다.
- Flow Control
- Half-Duplex, Full-Duplex
## Link Layer Location
- - -
각각의 호스트의 adapter(`network interface card, NIC`)에 구현되어 있다.
## Error Detection and Correction
- - - 
오류를 검출 및 정정하는 수신자의 능력을 순방향 오류 정정`(FEC, Forward Error Correction)`이라고 한다.
비트 오류를 방지하기 위해 송신 노드에서 데이터 D에 오류 검출 및 정정 비트들(EDC)를 첨가한다.  
수신 노드는 D\`와 EDC\`를 수신한다.
- ### Parity Bit
  사용자가 한 비트를 후가하고, 그 비트값을 d + 1개의 비트들에서 1의 총 개수가 짝수가 되도록 선택한다. 이는 짝수 패리티 기법이고,  
  홀수가 되도록 하게 하면 홀수 패리티 기법이다. --> 짝수개의 오류가 발생하면 유감 (2차원 패리티 기법도 있다)
- ### Internet Checksum
  k비트 정수들을 더해서 그 결과값을 오류 검출 비트들로 사용한다. 데이터의 바이트를 16비트 정수 단위로 취해서 더하고, 더한 값의 1의  
  보수가 인터넷 체크섬이 된다. 수신자는 합의 1의 보수를 취한 후, 한 비트라고 0이면 오류가 발생했고 알린다.
- ### CRC(Cyclic Redundancy Check, 순환중복검사)
  1. d를 r만큼 왼쪽으로 shift 한다.
  2. 나눗셈을 실행한다. 아래로 내려간 거의 MSB가 1이면 그냥 xor 하고, 아니면 한칸 더 내린다
  3. 나머지를 구한다 --> R
 ## 다중 접속 링크와 프로토콜
- - - 
모든 노드들이 프레임을 전송할 수 있으므로, 2개 이상의 노드가 동시에 프레임을 전송할 수 있다.  
이러면 모든 노드는 동시에 여러 개의 프레임을 받게 되고, 이것을 충돌이라고 한다.  
일반적으로 충돌이 발생하면 전송된 프레임의 의미를 파악할 수 없게 된다.
- ### 점대점 링크(PPP, HDLC)
- ### 브로드캐스트 링크 --> 다중 접속 문제
  - ### 채널 분할 프로토콜
    - TDM(Time Division Multiplexing), FDM(Frequency Division Multiplexing): 전송 노드가 하나라도 R/N bps
    - CDMA(Code Division Multiple Access)
      다른 코드를 각 노드에게 할당한다. 노드는 전송하는 데이터 비트들을 자신의 유일한 코드로 인코딩한다.
  - ### 랜덤 접속 프로토콜  
    충돌이 생기면 충돌과 관련된 각 노드는 프레임(패킷)이 충돌 없지 전송될 때까지 자신의 패킷을 계속해서 재전송한다.  
    그러나 충돌했을 때 노드는 핻아 프레임을 즉시 재전송할 필요가 없다. 대신 그 프레임을 재전송하기 전에 랜덤 지연 시간동안 기다린다.
    - #### Slotted ALOHA
      - 모든 패킷의 크기는 같다
      - 한 슬롯은 한 프레임 전송에 걸리는 시간과 같다
      - 노드는 슬롯의 시작점에서만 프레임을 전송하기 시작한다
      - 각 노드는 언제 슬롯이 시작하는지 알 수 있다 (동기화되어있다)
      - 한 슬롯에서 2개 이상의 프레임이 충돌하면, 모든 노드는 그 슬롯이 끝나기 전에 충돌 발생을 알게 된다.
      - 충돌 -> 랜덤 넘버 생성, 랜덤 넘버가 p(확률)이하면 다음에 재전송
      - 장점
        - 하나의 모드만 존재할 경우 최대 속도로 전송 가능
        - 탈중앙화가 잘 되어있다
        - 알고리즘이 단순하다
      - 단점
        - 확률에 따라 비어있는 슬롯이 발생할 수도 있다
        - 클럭에 동기화되야된다 (모든 노드의 시간이 정확하게 맞아야됨)
        - 충돌을 알아내기까지의 시간이 꽤 길다 (효율성이 떨어진다)
    - #### ALOHA (no slot)
      - 프레임이 도착하면 바로 전송한다
      - 충돌 확률이 증가한다 (2개의 슬롯을 보낼 시간동이나 아무런 패킷이 없어야 한다.)
      - 그래도 더 단순함
    - #### CSMA (carrier sense multiple access)
      - 전송 하기 전에 듣는다 (남이 전송하고 있으면 전송 안함) --> carrier sensing
      - 슬롯이 비어있음을 확인하면 패킷 통쨰로 전달
      - 다른 노드가 방해 프레임을 전송하고 있음을 검출하면, 자신의 전송을 중단한다
      - 충돌이 일어나면 모든 패킷을 다시 보내야됨, 유감
    - #### CSMA/CD (Collision Detection)
      - 충돌을 검사한다, 검출되면 중단
      - 내가 자신에게 보낸 시그널이 보낸 시그널과 다르면 충돌이 있다고 판단
      - 무선에는 힘듬 (간접이 있을 수 있어서)
      1. 데이터그램을 받으면 프레임 생성
      2. IDLE이라고 판단되면 전송 시작, BUSY면 기다림
      3. 보내면서 Collision 계속 확인
      4. 충돌 확인하면 곧바로 전송을 중단하고, Jamming Signal을 보낸다 (확인사살)
      5. 취소 후에 프레임을 회복시키는 방법은 Binary Exponential Backoff를 사용한다.
          - m번째 충돌에 [0, 2^m - 1] 사이의 랜덤 숫자를 선택, K * 512 만큼 기다림 --> step 2로 복귀
  - ### 순번 프로토콜 (Tacking Turns MAC protocols)
    - ##### polling
      - polling 메세지를 보내는 mater 노드가 있음, 하나씩 보낼 것이 있는지 물어본다
      - polling 오버헤드 latency, 마스터가 망가지면 전부 망가짐
    - ##### token passing
      - 보낼게 없으면 토큰을 다음 노드로 넘김, 다 쓰면 다음 노드로 넘김
      - token overhead, latency, 토큰 망가지면 전부 망가짐
  - ### DOCSIS
    - 보낼게 있으면 보내고 싶다고 CMTS에 요청함 (Map Frame)
    - upsteam 요청할 때 충돌이 발생할 수 있음 --> 어쩔 수 없음
## 근거리 스위치 네트워크
L2 Switch들로 구성된 망에서 경로는 설정하는 데에는 RIP나 OSPF와 같은 라우팅 알고리즘을 사용하지 않는다. 대신에 Link를 사용한다.  
- - - 
### ARP
호스트와 라우터들은 네트워크 계층 주소 뿐만 아니라 링크 계층 주소를 가진다. 랜은 IP와 인터넷만을 위해서가 아니라 임의의 네트워크 계층  
프로토콜을 위해 설계되었기 때문이다. MAC 대신에 네트워크 계층 주소를 사용하면, 네트워크 계층 주소를 어댑터 RAM에 저장하고 어댑터를  
이동할 떄마다 재구성해야 한다는 것이다.
- #### Mac Address (Link Layer Address)
  실제로 주소를 가지는 것은 NIC이다. 그러나 링크 계층 스위치는 호스트나 라우터를 연결해 주는 인터페이스에 링크 계층 주소를 할당받지 않는다.  
  MAC주소는 길이가 6바이트이며, 주소의 각 바이트는 2개의 16진수로 표시된다. IEEE가 MAC주소 공간을 관리하기 때문에, 어떻나 어댑터도  
  동일한 주소를 갖지 않는다. 패킷을 주신한 어댑터는 패킷 내부의 목적지 MAC 주소가 어댑터 자신의 MAC주소와 일치하는지 검사한다.  
  일치하면 데이터그램을 추출한다. 랜상의 다른 모든 아댑터가 자신이 전손한 프레임을 수신하고 처리하기를 원하면 FF-FF-FF-FF-FF-FF의  
  MAC 브로드캐스트 주소를 넣는다.
- #### ARP (Address Resolution Protocol, IP <-> MAC)
  - 동영상 정리
### Ethernet



